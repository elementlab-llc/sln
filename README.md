# API Скрининга лекарственных назначений (СЛН-Сервис)

Сервис **Скрининг лекарственных назначений** (далее – СЛН-Сервис) предназначен для проверки лекарственных назначений при оценке качества медицинской помощи, для оценки безопасности и обоснованности назначений с учетом конкретных условий назначения (комбинации лекарственных препаратов, формы и пути введения лекарственных препаратов), а также индивидуальных особенностей пациента (пола, возраста, грудного вскармливания, беременности, наличия аллергических реакций на какие-либо препараты, наличия/отсутствия сопутствующих заболеваний).

## Общая информация

Техническую информацию по предоставляемым API ресурсам, их параметрам и результатам можно получить на [странице справки][api-help].

На данный момент имеется реализация клиента на платформе .NET 4.5 - https://github.com/elementlab-llc/sln-net

### Схема
Доступ к API осуществляется по протоколу https.

Все данные отправляются и возвращаются в формате JSON. Во всех запросах, выполняемых методом POST, обязательно должен быть указан http-заголовок `Content-Type` со значением `text/json` или `application/json`

Поля, имеющие значение `null`, исключаются из возвращаемых данных.

Все значения даты указываются в формате YYYY-MM-DD.

### Идентификация и авторизация
Для получения идентификационных данных необходимо заключить договор на предоставление услуг с *ООО "Лаборатория медицинских информационных технологий "Элемент"*. После заключения договора пользователь получает идентификатор и секретный ключ.

Далее следует сформировать ключ доступа (токен) посредством запроса к ресурсу [POST account/token][account-token] с указанием идентификатора пользователя и секретного ключа.
Действие полученного токена не ограничено по времени. Тем не менее, клиентское ПО должно быть готово к тому, что текущий токен может стать недействительным. В таком случае перед следующим обращением к сервису необходимо получить новый токен.

Созданный токен требуется указывать при обращении ко всем остальным ресурсам сервиса. Передать токен можно одним из следующих способов:
- в параметре access_token в строке запроса к ресурсу:
`https://int.drugscreening.ru/v1/resource_url?access_token=<токен>`
- в виде значения http-заголовка Authorization:
`Authorization: Bearer <токен>`

## Концепты
Концепт – сущность определенного типа, относящаяся к предметной области. 

### Типы концептов
Получить список всех доступных типов концептов можно с использованием [GET concepts/types][concepts-types].

Примеры типов концептов:
- `DispensableDrug`         - Лекарственное средство
- `ScreenableIngredient`     - Ингредиент
- `ICD10CM`                 - Диагноз в соответствии со справочником МКБ-10
- `InteractionSeverityLevel` - Уровень риска при лекарственном взаимодействии

### Получение списка концептов

Существует несколько способов получения списка концептов

#### Получение всех концептов определенного типа

Получить список всех концептов определенного типа можно обращением к ресурсу [GET concepts/list][concepts-list]

#### Поиск концептов

Для поиска концептов предназначен ресурс [GET concepts/find][concepts-find], который позволяет выполнять поиск несколькими способами:
1. Нечеткий поиск по названиям концептов. При этом учитываются синонимы и названия концепта на различных языках.
1. Точный поиск по штрихкоду. Этот вид поиска поддерживается только для концептов "Лекарственное средство" (DispensableDrug) и "БАД" (DietarySupplement).
1. Точный поиск по названию. При использовании этого способа в результатах поиска возвращаются те концепты, названия которых полностью равны искомому значению.   

### Экземпляры концептов

Каждый экземпляр концепта описывается следующими атрибутами:

- `Type` - Тип концепта.
- `Code` - Код концепта. Этот код уникален только в рамках одного типа, поэтому концепты разных типов могут иметь одинаковые коды
- `Name` - Наименование концепта. Язык, на котором название концепта возвращается при вызовах, зависит от языка, указанного в http-заголовке `Accept-Language`

### Примеры концептов

|Type|Code|Name|
|---|---|---|
|DispensableDrug|DD0018158|Варфарекс табл. 1мг|
|ScreenableIngredient|SI001763|Этанол|
|ICD10CM|J20|Острый бронхит|
|InteractionSeverityLevel|2|Средний|

## Скрининг
Для выполнения скрининга необходимо выполнить следующий запрос [POST screening][screening]


В теле запроса необходимо перечислить коды видов скрининга, которые требуется выполнить, а также передать список проверяемых лекарственных препаратов. Все остальные параметры являются необязательными. Тем не менее, рекомендуется передавать максимально подробную информацию о состоянии пациента: его демографические характеристики, имеющиеся хронические и острые заболевания, а также список известных аллергенов.

Простейший пример запроса на скрининг:
```json
{
  "ScreeningTypes": "DrugFoodInteractions, DrugAlcoholInteractions",
  "Drugs": [
    {
      "Code": "DD0009389",
      "Type": "DispensableDrug",
      "Name": "Варфарекс табл. 3мг"
    }
  ]
}
```

### Доступные виды скринингов

|Код|Описание|
|----|----|
|**DrugDrugInteractions**      |Скрининг взаимодействий лекарственных средств друг с другом.|
|**DrugFoodInteractions**      |Скрининг взаимодействий лекарственных средств с пищей.|
|**DrugAlcoholInteractions**   |Скрининг взаимодействий лекарственных средств с алкоголем.|
|**AllergicReactions**         |Скрининг возможных аллергических реакций.|
|**DuplicateTherapy**          |Скрининг на наличие дупликативной терапии.|
|**AgeContraindications**      |Скрининг противопоказаний по возрастным характеристикам.|
|**GenderContraindications**   |Скрининг противопоказаний по половой принадлежности.|
|**LactationContraindications**|Скрининг противопоказаний при лактации.|
|**PregnancyContraindications**|Скрининг противопоказаний при беременности|
|**DiseaseContraindications**  |Скрининг противопоказаний при диагнозе|
|**DopingAlerts**              |Допинг-контроль для спортсменов|
|**GeneticTesting**            |Фармакогенетический скрининг|

### Рекомендации по использованию API
Для улучшения работы сервиса и сокращения времени, требуемого на обработку запроса, рекомендуется придерживаться определенных правил.
 
#### Количество лекарственных препаратов, аллергий и диагнозов
Так как сервис выполняет скрининг по принципу «каждый с каждым», увеличение количества входных параметров приводит к значительному росту времени обработки. Например, если запрошен скрининг взаимодействий препарат-препарат для 10 лекарственных средств, сервисом будет выполнено 45 проверок, а для 100 препаратов - уже 4950. Если учесть, что каждая проверка может занимать от 1 до 20 миллисекунд, то время, необходимое только для выполнения одного этого вида скрининга, может составить около 1 секунды для 10 препаратов и до 2-х минут для 100 препаратов. Если же запрошено выполнение всех видов скрининга, время обработки запроса по 100 препаратом приблизится к 10-15 минутам.

#### Параметры, значения которых не определены
Не следует включать в запрос параметры, значения которых не заданы. Например, если дата рождения пациента не определена, необходимо исключить из запроса поле `$.Patient.BirthDate`, а не передавать пустую строку или значение «0001-01-01». 

Аналогично, не следует передавать значение «0» в таких параметрах, как `$.Patient.CreatinineClearance`, `$.Patient.Weight` или `$.Patient.BodySurfaceArea`.

#### Изделия медицинского назначения, не являющиеся лекарственными средствами
В список препаратов следует включать только лекарственные средства (имеющие регистрационное удостоверение лекарственного средства), которые требуется проверить. Не следует включать  в параметры запроса изделия медицинского назначения такие например, как «Вата» или «Шприц медицинский».
 
#### Назначения без расписания приема
Поле `Schedule` желательно целиком исключить из запроса для тех препаратов, у которых не определена дата начала приема.

#### Последовательные назначения
Необходимо объединять в одно назначение несколько назначений одного и того же препарата, если периоды приема следуют друг за другом без перерыва. 

Например, если препарат первый раз назначен с 10 по 12 февраля, а затем с 13 по 16 февраля, в запросе этот препарат следует указывать только один раз с периодом приема с 10 по 16 февраля.

### Рекомендации по представлению результатов скрининга в интерфейсе пользователя

#### Цвета иконок

Иконки рекомендуется окрашивать в один из следующих цветов в зависимости от уровня риска:

Цвет|Значение
---|---
Красный|высокий риск/важность
Желтый|средний риск/важность
Синий|низкий риск/важность
Серый|предупреждение отсутствует

*Зеленый цвет использовать не следует, так как он ассоциируется у пользователей с отсутствием опасности, в то же время отсутствие предупреждения этого не гарантирует.*

Рекомендуется располагать иконки в один или два ряда рядом с препаратом, для которого они предназначаются.

#### Возможный способ определения обобщенного уровня риска для видов скрининга

Каждый вид скрининга имеет свою собственную шкалу уровня риска/важности предупреждений

##### Взаимодействия Препарат-Препарат, Препарат-Пища, Препарат-Алкоголь
Вычисляется на основании значения поля `Severity.Level`

`Severity.Level`|Риск
---|--
10000|высокий
20000|средний
30000|низкий 

##### Аллергические реакции
Уровень риска всегда высокий.

##### Противопоказания для возраста, пола, диагноза, беременности и лактации
Вычисляется на основании значения поля `Severity.Level`

`Severity.Level`|Риск
---|--
1|высокий
2|высокий
3|средний
4|низкий 
5|низкий 

##### Дупликативная терапия
Уровень риска всегда средний

##### Фармакогенетическое тестирование
Вычисляется на основании значения поля `Severity.Level`

`Severity.Level`|Риск
---|--
10000|высокий
20000|средний
30000|низкий 

#### Краткие предупреждения
При клике на подсвеченную иконку должно открываться краткое предупреждение, описывающее суть выявленного взаимодействия / противопоказания. Рекомендуется располагать это предупреждение под иконками.

#### Рефераты
Если предполагается, что использовать СЛН-Сервис будут люди с медицинским образованием, то для них должна быть выведена на экран кнопка или ссылка, при нажатии на которую будет открываться окно с текстом профессионального реферата, подробно описывающего текущее предупреждение.

Для пользователей без медицинского образования имеются рефераты, которые мы также рекомендуем выводить при нажатии на кнопку или ссылку.

Рефераты рекомендуется отображать в отдельном окне.

#### Инструкции
В СЛН-сервисе для каждого препарата содержатся инструкции. Мы рекомендуем рядом с названием препарата располагать иконку, при нажатии на которую будет открываться отдельное окно с текстом инструкции.

Для получения всех инструкций для концепта по его типу и коду, следует обратиться к ресурсу [GET instructions/list][instructions-list]. В ответе будет возвращен список доступных инструкций.

Для получения конкретной инструкции из списка предназначен ресурс [GET instructions/{code}][instruction-content]. Текст инструкции представлен в формате XML. Для его преобразования в формат HTML можно использовать [XSLT-шаблон][instruction-xslt].

Текст инструкции разбит на разделы, поэтому в самом верху рекомендуется расположить рубрикатор инструкции. При клике на конкретную рубрику текст инструкции должен «перескакивать» на интересующий пользователя раздел.


[api-instance]: https://int.drugscreening.ru/v1/
[api-help]: https://int.drugscreening.ru/v1/help
[account-token]: https://int.drugscreening.ru/v1/help/api/POST-account-token
[screening]: https://int.drugscreening.ru/v1/help/api/POST-screening
[concepts-types]: https://int.drugscreening.ru/v1/help/api/GET-concepts-types
[concepts-find]: https://int.drugscreening.ru/v1/help/api/GET-concepts-find_q_type_searchBy_limit
[concepts-list]: https://int.drugscreening.ru/v1/help/api/GET-concepts-list-type_start_pageSize
[instructions-list]: https://int.drugscreening.ru/v1/help/api/GET-instructions_type_code
[instruction-content]: https://int.drugscreening.ru/v1/help/api/GET-instructions-code
[instruction-xslt]: instruction-manual.xslt
